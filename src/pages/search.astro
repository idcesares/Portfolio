---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import SearchBox from '../components/SearchBox.astro';
---

<BaseLayout title="Busca | Isaac D'Césares" description="Busque por posts e projetos no site">
	<div class="stack gap-20">
		<main class="wrapper stack gap-8">
			<Hero
				title="Busca"
				tagline="Encontre posts, projetos e conteúdo no site"
				align="start"
			/>
			<div class="search-page-container">
				<SearchBox placeholder="Busque por posts, projetos e mais..." />
				<div id="search-page-results" class="search-page-results">
					<div class="search-instructions">
						<p>Digite pelo menos 2 caracteres para começar a busca.</p>
						<p>Você pode buscar por títulos, descrições, conteúdo ou tags.</p>
					</div>
				</div>
			</div>
		</main>
	</div>
</BaseLayout>

<script>
	import '../scripts/search.ts';
	
	// Enhanced search for dedicated search page
	document.addEventListener('DOMContentLoaded', () => {
		const searchInput = document.getElementById('search-input') as HTMLInputElement;
		const searchPageResults = document.getElementById('search-page-results');
		const searchResults = document.getElementById('search-results');
		
		if (searchInput && searchPageResults && searchResults) {
			// Clone results to the page results container
			const observer = new MutationObserver((mutations) => {
				mutations.forEach((mutation) => {
					if (mutation.type === 'childList' && mutation.target === searchResults) {
						const hasResults = searchResults.children.length > 0 && !searchResults.classList.contains('hidden');
						
						if (hasResults) {
							searchPageResults.innerHTML = searchResults.innerHTML;
							searchPageResults.style.display = 'block';
						} else if (searchInput.value.length >= 2) {
							searchPageResults.innerHTML = '<div class="search-no-results">Nenhum resultado encontrado</div>';
							searchPageResults.style.display = 'block';
						} else {
							searchPageResults.innerHTML = `
								<div class="search-instructions">
									<p>Digite pelo menos 2 caracteres para começar a busca.</p>
									<p>Você pode buscar por títulos, descrições, conteúdo ou tags.</p>
								</div>
							`;
						}
					}
				});
			});
			
			observer.observe(searchResults, { childList: true });
			
			// Hide the dropdown results on search page
			searchResults.style.display = 'none';
		}
	});
</script>

<style>
	.search-page-container {
		max-width: 800px;
		margin: 0 auto;
	}

	.search-page-results {
		margin-top: 2rem;
		min-height: 300px;
	}

	.search-instructions {
		text-align: center;
		color: var(--gray-400);
		font-style: italic;
		padding: 2rem;
	}

	.search-instructions p {
		margin: 0.5rem 0;
	}

	:global(.search-page-results .search-result-item) {
		display: block;
		padding: 1.5rem;
		border: 1px solid var(--gray-800);
		border-radius: 0.5rem;
		margin-bottom: 1rem;
		text-decoration: none;
		color: inherit;
		background: var(--gray-999);
		transition: all 0.2s ease;
	}

	:global(.search-page-results .search-result-item:hover) {
		border-color: var(--accent-regular);
		background: var(--gray-800);
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	}

	:global(.search-page-results .search-result-title) {
		font-size: var(--text-lg);
		margin-bottom: 0.5rem;
	}

	:global(.search-page-results .search-result-description) {
		font-size: var(--text-base);
		line-height: 1.6;
	}

	:global(.search-page-results .search-result-type) {
		margin-bottom: 0.5rem;
	}

	:global(.search-page-results .search-no-results) {
		text-align: center;
		padding: 2rem;
		color: var(--gray-400);
		font-style: italic;
		font-size: var(--text-lg);
	}

	/* Light theme adjustments */
	:global([data-theme="light"]) :global(.search-page-results .search-result-item) {
		background: var(--gray-0);
		border-color: var(--gray-300);
	}

	:global([data-theme="light"]) :global(.search-page-results .search-result-item:hover) {
		background: var(--gray-100);
		border-color: var(--accent-regular);
	}
</style>
