---
import MainHead from '../components/MainHead.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';

interface Props {
	title?: string | undefined;
	description?: string | undefined;
	image?: string | undefined;
	imageAlt?: string | undefined;
	ogType?: 'website' | 'article';
	article?: {
		publishedTime?: string;
		modifiedTime?: string;
		expirationTime?: string;
		authors?: string[];
		section?: string;
		tags?: string[];
	};
	structuredData?: Record<string, unknown> | Array<Record<string, unknown>>;
}

const { title, description, image, imageAlt, ogType, article, structuredData } = Astro.props;
---

<html lang="pt-BR">
	<head>
	<script is:inline type="text/partytown" async src="https://www.googletagmanager.com/gtag/js?id=G-0XZV7NBH4E"></script>
	<script is:inline type="text/partytown">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'G-0XZV7NBH4E');
		</script>
                <MainHead
                        title={title}
                        description={description}
                        image={image}
                        imageAlt={imageAlt}
                        ogType={ogType}
                        article={article}
                        structuredData={structuredData}
                />
	</head>
	<body>
		<div class="stack backgrounds">
			<Nav transition:persist />
			<slot />
			<Footer />
		</div>

		<script>
			addEventListener('load', () => document.documentElement.classList.add('loaded'));

			// Scroll Reveal Animation System
			function initScrollReveal() {
				const animatedElements = document.querySelectorAll('[data-animate]');
				
				if (!animatedElements.length) return;

				// Check for reduced motion preference
				const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
				
				if (prefersReducedMotion) {
					// If reduced motion, make all elements visible immediately
					animatedElements.forEach(el => el.classList.add('is-visible'));
					return;
				}

				const observer = new IntersectionObserver(
					(entries) => {
						entries.forEach(entry => {
							if (entry.isIntersecting) {
								entry.target.classList.add('is-visible');
								// Unobserve after animation (one-time reveal)
								observer.unobserve(entry.target);
							}
						});
					},
					{
						threshold: 0.1,
						rootMargin: '0px 0px -50px 0px'
					}
				);

				animatedElements.forEach(el => observer.observe(el));
			}

			// Run on initial load
			initScrollReveal();

			// Re-run after view transitions (Astro's client-side navigation)
			document.addEventListener('astro:page-load', initScrollReveal);
		</script>

		<style>
			:root {
				--bg-noise: url('/assets/backgrounds/noise.png');
				--bg-ambient-1: radial-gradient(
					1200px 600px at 6% -10%,
					rgba(47, 111, 109, 0.16),
					transparent 60%
				);
				--bg-ambient-2: radial-gradient(
					900px 500px at 92% 10%,
					rgba(28, 42, 58, 0.12),
					transparent 55%
				);
				--bg-ambient-3: radial-gradient(
					1000px 700px at 50% 110%,
					rgba(143, 182, 198, 0.12),
					transparent 60%
				);
				--bg-glow: radial-gradient(
					800px 500px at 40% 0%,
					rgba(47, 111, 109, 0.08),
					transparent 60%
				);
				--bg-base: linear-gradient(180deg, var(--gray-999) 0%, #efe7e0 100%);
			}

			:root.theme-dark {
				--bg-ambient-1: radial-gradient(
					1200px 600px at 6% -10%,
					rgba(90, 154, 166, 0.2),
					transparent 60%
				);
				--bg-ambient-2: radial-gradient(
					900px 500px at 92% 10%,
					rgba(43, 58, 70, 0.16),
					transparent 55%
				);
				--bg-ambient-3: radial-gradient(
					1000px 700px at 50% 110%,
					rgba(90, 154, 166, 0.12),
					transparent 60%
				);
				--bg-glow: radial-gradient(
					900px 600px at 40% 0%,
					rgba(90, 154, 166, 0.12),
					transparent 60%
				);
				--bg-base: linear-gradient(180deg, var(--gray-999) 0%, #0f0c0a 100%);
			}

			:root.loaded {
				--bg-glow: radial-gradient(
					900px 600px at 40% 0%,
					rgba(47, 111, 109, 0.14),
					transparent 60%
				);
			}
			:root.loaded.theme-dark {
				--bg-glow: radial-gradient(
					900px 600px at 40% 0%,
					rgba(90, 154, 166, 0.18),
					transparent 60%
				);
			}

			.backgrounds {
				min-height: 100%;
				isolation: isolate;
				background:
					var(--bg-noise) top center/200px repeat,
					var(--bg-ambient-1),
					var(--bg-ambient-2),
					var(--bg-ambient-3),
					var(--bg-glow),
					var(--bg-base);
				background-blend-mode: soft-light, normal, normal, normal, normal, normal;
			}
			@media (forced-colors: active) {
				.backgrounds {
					background: none;
					background-blend-mode: none;
				}
			}
		</style>
	</body>
</html>
